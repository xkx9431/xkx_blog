---
layout:     post
title:      "输入网址，再按回车后面发生了什么？"
subtitle:   " \"CAE\""
date:       2019-11-21 21:52:00
author:     "許敲敲"
header-img: "img/cae-bg.png"
tags:
    - 学习
    - WEB
---

> “到底发生了什么？？? ”

## 前言
如题，如果你是一名web developer,那么你一定要知道这个到底是什么过程？从浏览器判别输入是否为搜索关键字还是URL一直到页面render完整呈现,这里面涉及到网络，操作系统，Web的一些知识点。这里面的知识点比较零散。如果能系统而又全面的回答出这个问题，那么他一定是个好Web developer。

我想做个好Web developer……

## 正文

## 浏览器视觉下的过程

首先可以简单梳理一下这个过程，如果从浏览器视角的话，该过程的主要流程示意图可以如下图所示：

![从输入URL 到页面展示流程示意图]({{site.baseurl}}/img/web_pics/URLtoPage.png)

从图中就可以了解到输入URL到页面解析的整个过程。

首先需要从操作系统的角度来知道，该过程需要有浏览器进程、渲染进程和网络进程之间的相互配合。Chrome 浏览器来讲，其最新的进程架构包括：1 个浏览器（Browser）主进程、1 个 GPU 进程、1 个网络（NetWork）进程、多个渲染进程和多个插件进程。其中各进程的主要任务介绍如下：
+ **浏览器进程**。主要负责界面显示、用户交互、子进程管理，同时提供存储等功能。
+ **渲染进程**。核心任务是将 HTML、CSS 和 JavaScript 转换为用户可以与之交互的网页，排版引擎 Blink 和 JavaScript 引擎 V8 都是运行在该进程中，默认情况下，Chrome 会为每个 Tab 标签创建一个渲染进程。出于安全考虑，渲染进程都是运行在沙箱模式下。
+ **GPU 进程**。其实，Chrome 刚开始发布的时候是没有 GPU 进程的。而 GPU 的使用初衷是为了实现 3D CSS 的效果，只是随后网页、Chrome 的 UI 界面都选择采用 GPU 来绘制，这使得 GPU 成为浏览器普遍的需求。最后，Chrome 在其多进程架构上也引入了 GPU 进程。
+ **网络进程**。主要负责页面的网络资源加载，之前是作为一个模块运行在浏览器进程里面的，直至最近才独立出来，成为一个单独的进程。
+ **插件进程**。主要是负责插件的运行，因插件易崩溃，所以需要通过插件进程来隔离，以保证插件进程崩溃不会对浏览器和页面造成影响。

所以该过程的主要流程可以参考如下：
+ 用户在浏览器进程里输入**Query**
+ 网络进程发起**URL请求**
+ 服务器响应URL请求之后，浏览器开始**准备渲染进程**。
+ 渲染进程ready,再通知浏览器进程‘可以展示页面’,该阶段也称为“**提交文档**”。
+ 浏览器进程接收到“提交文档”后，就开始移除之前新的文档，并通知渲染进程开始“**解析页面**”。


### 1.输入Query
当user 在地址栏输入一个查询关键字的时候，地址栏会判断，输入的是需要**搜索的关键字**，还是**请求的URL**。如果是关键字，地址栏会结合浏览器所设置的搜索引擎来生成一个带输入关键字的URL,然后开始发起URL请求。如果浏览器判断输入的是合法的URL，那么浏览器也会进行相应的修正，比如为baidu.com 加上协议，合成完整的URL：https://www.baidu.com 然后开始请求。

当用户输入关键字并键入回车之后，这意味着当前页面即将要被替换成新的页面，不过在这个流程继续之前，浏览器还给了当前页面一次执行 beforeunload 事件的机会，beforeunload 事件允许页面在退出之前执行一些数据清理操作，还可以询问用户是否要离开当前页面，比如当前页面可能有未提交完成的表单等情况，因此用户可以通过 beforeunload 事件来取消导航，让浏览器不再执行任何后续工作。

从浏览器搜索栏键入 baidu.com 开始，就可以看到浏览器会有之前的搜索记录匹配。

![输入URL的浏览器的缓存搜索记录匹配]({{site.baseurl}}/img/web_pics/baidu.sr.png)

### 2. URL请求过程
